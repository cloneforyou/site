--- a/node_modules/posthtml-webp/lib/index.js
+++ b/node_modules/posthtml-webp/lib/index.js
@@ -13,6 +13,10 @@ module.exports = function (options) {
     options.extensionIgnore = []
   }
 
+  if (options.domainIgnore === undefined) {
+    options.domainIgnore = []
+  }
+
   if (options.replaceExtension === undefined) {
     options.replaceExtension = false
   }
@@ -24,7 +28,8 @@ module.exports = function (options) {
       var extension = imgNode.attrs.src.split('.').pop()
       var isIgnoredByClass = options.classIgnore.filter(className => classes.includes(className)).length > 0
       var isIgnoredByExtension = options.extensionIgnore.filter(fileExtension => fileExtension === extension).length > 0
-      var isIgnore = isIgnoredByClass || isIgnoredByExtension
+      var isIgnoredByDomain = options.domainIgnore.some(d => imgNode.attrs.src.includes(d))
+      var isIgnore = isIgnoredByClass || isIgnoredByExtension || isIgnoredByDomain
       if (isIgnore) return imgNode
       switch (imgNode.tag) {
         case 'amp-img':
@@ -83,11 +88,11 @@ function getPicture (imgNode, options) {
     .concat(src)
     .filter(Boolean)
     .map(value => {
-      value = value.trim().split(/\s/)
-      var path = options.replaceExtension ? removeExtension(value[0]) : value[0]
-      var size = value[1]
+      var [pathAndQuery, size] = value.trim().split(/\s/)
+      var [path, query] = pathAndQuery.split("?");
+      var cleanedPath = options.replaceExtension ? removeExtension(path) : path
 
-      return [path + '.webp', size].filter(Boolean).join(' ')
+      return [cleanedPath + '.webp' + (query ? `?${query}` : ""), size].filter(Boolean).join(' ')
     })
     .join(', ')
